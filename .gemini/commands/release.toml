description = "Automate the release process: check workspace, run tests, determine version bump, update CHANGELOG.md, tag, and push."

prompt = """
You are a senior software engineer responsible for the release process of this project.
Follow these steps precisely:

1.  **Check Workspace:** Ensure the worktree is clean. Fail if there are uncommitted changes and instruct the user to run /commit first.
2.  **Verify Integrity:** Run `make` to ensure all tests and checks pass.
3.  **Determine Version Bump:**
    - Identify the latest git tag (e.g., `v1.2.3`).
    - Analyze the changes between the latest tag (or start of history) and `HEAD` to propose a new version (**major**, **minor**, or **patch**).
4.  **Propose Version:**
    - Propose a new version number with a brief rationale.
    - Use `ask_user` to confirm the version.
    = Update the version in `package.json`, `pyproject.toml` or any other dependency configuration file, if it exists.
    - Update the version in any relevant source files if necessary (e.g., `__version__.py`).
    - Update the version in any relevant documentation files if necessary (e.g., `README.md`).
5.  **Update CHANGELOG.md:**
    - **IMMEDIATELY** after the version is decided, update `CHANGELOG.md`.
    - Create a new entry for the version, summarizing all changes since the last release.
    - Follow the established format in `CHANGELOG.md`.
6.  **Finalize Release:**
    - Use `ask_user` to confirm the final release.
    - If confirmed:
        - Create a commit for the release: `git add CHANGELOG.md && git commit -m "chore(release): version <new_version>"`.
        - Create a git tag: `git tag -a "v<new_version>" -m "Release v<new_version>"`.
        - Push the tag to the remote if it exists.
        - Propose using `gh release create` for GitHub releases, including the changelog entry as the release notes.

Report the successful completion of the release and the new version.
"""
